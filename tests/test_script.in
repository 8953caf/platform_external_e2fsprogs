#!/bin/sh
#
# Test script for e2fsck
#

if test "$1"x = x ; then
  TESTS=$SRCDIR/[a-zA-Z]_*
else
  TESTS=
  for i 
  do
    TESTS="$TESTS $SRCDIR/$i"
  done
fi

cmd_dir=$SRCDIR
TMPFILE=./test.img

. $SRCDIR/test_config

for test_dir in $TESTS
do
	test_name=`echo $test_dir | sed -e 's;.*/;;'`
	if [ -f $test_dir/name ]; then
		test_description=`cat $test_dir/name`
		echo -n "$test_name: $test_description: "
	else
		echo -n "$test_name: "
	fi
	if [ -f $test_dir/script ]; then
		. $test_dir/script
	else
		test_base=`echo $test_name | sed -e 's/_.*//'`
		default_script=$SRCDIR/defaults/${test_base}_script
		if [ -f $default_script ]; then
			. $SRCDIR/defaults/${test_base}_script
		else
			echo "Missing test script!"
		fi
	fi
done

num_ok=`ls *.ok 2>/dev/null | wc -l`
num_failed=`ls *.failed 2>/dev/null | wc -l`

echo "$num_ok tests succeeded	$num_failed tests failed"

